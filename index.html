<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Dragon's Keep</title>

    <!-- PWA / Mobile App Capabilities -->
    <!-- <link rel="manifest" href="manifest.json"> -->
    <link rel="icon" href="icons/icon-512.png" type="image/png">
    <link rel="apple-touch-icon" href="icons/icon-512.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0c0a09">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="src/css/styles.css">
    <!-- Chromecast SDK -->
    <!-- Chromecast SDK -->
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</head>

<body
    class="min-h-screen bg-stone-950 text-amber-50 font-serif flex flex-col relative overflow-y-auto selection:bg-red-900 selection:text-white">

    <!-- Local Audio Elements -->
    <audio id="valley-audio" src="sounds/dragon-valley.mp3" loop preload="auto" class="hidden"></audio>
    <audio id="sleeping-audio" src="sounds/sleeping-dragon.mp3" loop preload="auto" class="hidden"></audio>
    <audio id="rain-audio" src="sounds/rain.mp3" loop preload="auto" class="hidden"></audio>
    <audio id="fireplace-audio" src="sounds/fireplace.mp3" loop preload="auto" class="hidden"></audio>

    <!-- Embers Canvas -->
    <canvas id="embers-canvas" class="fixed inset-0 w-full h-full pointer-events-none mix-blend-screen -z-40"></canvas>

    <!-- Background Texture -->
    <!-- Background Texture -->
    <div id="bg-layer"
        class="fixed inset-0 opacity-20 pointer-events-none mix-blend-overlay transition-all duration-1000 bg-center bg-cover"
        style="background-image: url(&quot;data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E&quot;)">
    </div>
    <video id="bg-video" autoplay loop muted playsinline
        class="fixed inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-1000 -z-50 hidden"></video>

    <!-- Main Content -->
    <div class="flex-grow flex flex-col items-center justify-center p-6 z-10 w-full max-w-7xl mx-auto my-8">

        <!-- Header -->
        <header class="mb-8 w-full flex flex-col items-center">
            <!-- Top Bar (Settings / Cast) -->
            <div class="w-full flex justify-end gap-4 mb-2 md:absolute md:top-0 md:right-0 md:mb-0 z-20">
                <!-- Cast Button Placeholder -->
                <google-cast-launcher
                    class="w-10 h-10 md:w-8 md:h-8 opacity-70 hover:opacity-100 transition-opacity cursor-pointer"></google-cast-launcher>

                <!-- Background Settings Toggle -->
                <button id="minimalist-btn" class="text-stone-500 hover:text-amber-100 transition-colors p-2"
                    title="Minimalist Mode">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" />
                    </svg>
                </button>
                <button id="bg-settings-btn" class="text-stone-500 hover:text-amber-100 transition-colors p-2"
                    title="Change Environment">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        <circle cx="12" cy="10" r="3" />
                    </svg>
                </button>
            </div>

            <!-- Title -->
            <div class="text-center relative z-10">
                <h1
                    class="font-medieval text-3xl md:text-6xl font-black tracking-widest text-red-700 uppercase drop-shadow-lg leading-tight">
                    The Dragon's Keep
                </h1>
                <p class="mt-2 text-stone-400 italic text-base md:text-lg tracking-wider">
                    Rest weary traveller, beneath the wings of the beast.
                </p>
            </div>
        </header>

        <!-- Visualizer -->
        <div id="visualizer-container"
            class="relative w-64 h-64 md:w-80 md:h-80 mb-12 transition-transform duration-[3000ms] scale-100">
            <!-- Glow -->
            <div id="visualizer-glow"
                class="absolute inset-0 bg-red-600 rounded-full blur-[60px] opacity-0 transition-opacity duration-[2000ms]">
            </div>

            <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-2xl">
                <!-- Outer Ring -->
                <circle cx="50" cy="50" r="45" stroke="#78350f" stroke-width="2" fill="none" class="opacity-50" />
                <circle cx="50" cy="50" r="40" stroke="#78350f" stroke-width="1" fill="none" stroke-dasharray="4 2"
                    class="opacity-30" />

                <!-- Dragon Silhouette -->
                <path d="M50 20 C60 20 75 30 75 50 C75 70 60 80 50 80 C40 80 25 70 25 50 C25 30 40 20 50 20 Z"
                    fill="#1c1917" stroke="#b91c1c" stroke-width="1.5" />
                <path d="M50 25 C55 25 65 35 65 50 C65 65 55 75 50 75 C45 75 35 65 35 50 C35 35 45 25 50 25 Z"
                    fill="#292524" />

                <!-- Eye Group (Animated) -->
                <g id="dragon-eye-group" class="origin-center transition-all duration-[2000ms] ease-in-out opacity-50"
                    style="transform: scaleY(0.1);">
                    <path d="M50 40 C52 40 55 45 55 50 C55 55 52 60 50 60 C48 60 45 55 45 50 C45 45 48 40 50 40 Z"
                        fill="#fcd34d" />
                    <rect x="49" y="42" width="2" height="16" fill="#000" rx="1" />
                </g>
            </svg>
        </div>

        <!-- Controls Container (Removed Master Button as requested) -->
        <div class="flex flex-col items-center gap-6 mb-8 w-full max-w-md">
            <!-- Master Play/Pause -->
            <button id="master-btn"
                class="w-16 h-16 rounded-full bg-red-900/20 border border-red-800 text-red-500 hover:bg-red-900/40 hover:text-red-300 transition-all flex items-center justify-center backdrop-blur-sm group shadow-[0_0_15px_rgba(185,28,28,0.2)] hover:shadow-[0_0_25px_rgba(185,28,28,0.4)]">
                <svg id="master-icon-play" class="w-8 h-8 ml-1 group-hover:scale-110 transition-transform"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z" />
                </svg>
                <svg id="master-icon-pause" class="hidden w-8 h-8 group-hover:scale-110 transition-transform"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                </svg>
            </button>



            <!-- Advanced Audio Toggles -->
            <div class="flex gap-4">
                <button id="spatial-btn"
                    class="px-4 py-2 rounded-full border border-stone-800 text-stone-500 text-sm uppercase tracking-widest hover:border-red-900 hover:text-amber-100 transition-all">
                    Spatial Audio: Off
                </button>
            </div>
        </div>

        <!-- Mixer Board -->
        <h2 class="section-header mt-8 mb-4">Ambient Sounds</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 w-full max-w-[1400px] px-2 md:px-4">

            <!-- Dragon Valley -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="valley">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m8 3 4 8 5-5 5 15H2L8 3z" />
                    </svg>
                </div>
                <span
                    class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Dragon
                    Valley</span>
                <input type="range" id="vol-valley" min="0" max="1" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

            <!-- Sleeping Dragon -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="sleeping">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 4v16" />
                        <path d="M2 8h18a2 2 0 0 1 2 2v10" />
                        <path d="M2 17h20" />
                        <path d="M6 8v9" />
                    </svg>
                </div>
                <span
                    class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Sleeping
                    Dragon</span>
                <input type="range" id="vol-sleeping" min="0" max="1" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

            <!-- Rain Sounds -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="rain">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" />
                        <path d="M16 14v6" />
                        <path d="M8 14v6" />
                        <path d="M12 16v6" />
                    </svg>
                </div>
                <span
                    class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Rain</span>
                <input type="range" id="vol-rain" min="0" max="1" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

            <!-- Fireplace -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="fireplace">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.115.385-2.256 1-3.24A8.8 8.8 0 0 1 8.5 14.5Z" />
                    </svg>
                </div>
                <span
                    class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Fireplace</span>
                <input type="range" id="vol-fireplace" min="0" max="1" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

        </div>

        <!-- Generators Section -->
        <h2 class="section-header mt-8 mb-4">Noise Generators</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 md:gap-4 w-full max-w-[1400px] px-2 md:px-4">

            <!-- Brown Noise -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="brown">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 12h20M2 12c2 4 5 4 7 0 3-4 6-4 8 0 1 2 3 2 5 0" />
                    </svg>
                </div>
                <span
                    class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Brown</span>
                <input type="range" id="vol-brown" min="0" max="0.5" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

            <!-- Pink Noise -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="pink">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 12c2 4 5 4 7 0 3-4 6-4 8 0 1 2 3 2 5 0" />
                    </svg>
                </div>
                <span
                    class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Pink</span>
                <input type="range" id="vol-pink" min="0" max="0.5" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

            <!-- Green Noise -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="green">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.77 10.3-9.69 10.3z" />
                    </svg>
                </div>
                <span
                    class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Green</span>
                <input type="range" id="vol-green" min="0" max="0.5" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

            <!-- Binaural Focus (40Hz) -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="focus">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 6v6l4 2" />
                    </svg>
                </div>
                <span class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Focus
                    40Hz</span>
                <input type="range" id="vol-binaural-40" min="0" max="1" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

            <!-- Binaural Sleep (4Hz) -->
            <div class="sound-card bg-stone-900/80 p-3 md:p-4 rounded-xl border border-stone-800 shadow-lg flex flex-col items-center gap-3 backdrop-blur-sm relative overflow-hidden"
                data-sound="sleep">
                <div class="sound-icon p-2 md:p-3 rounded-full bg-stone-950 border border-stone-800 text-stone-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </div>
                <span class="text-xs md:text-sm font-semibold text-stone-400 uppercase tracking-wider text-center">Sleep
                    4Hz</span>
                <input type="range" id="vol-binaural-4" min="0" max="1" step="0.01" value="0.0" class="w-full">
                <div class="volume-indicator" style="transform: scaleX(0);"></div>
            </div>

        </div>

        <!-- Productivity Tools -->
        <h2 class="section-header mt-8 mb-4">Tools</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-[1400px] px-2 md:px-4 mb-24">

            <!-- Sleep Timer -->
            <div
                class="bg-stone-900/50 p-6 rounded-lg border border-stone-800 backdrop-blur-sm shadow-xl flex flex-col justify-between">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3 text-stone-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg>
                        <span class="text-base font-bold uppercase tracking-wider">Sleep Timer</span>
                    </div>
                    <span id="timer-display" class="text-amber-500 font-mono text-2xl font-bold">Off</span>
                </div>

                <!-- Quick Select Buttons (Mobile Friendly) -->
                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button onclick="addTime(15)"
                        class="py-3 px-2 text-sm font-bold text-stone-400 bg-stone-950 hover:bg-stone-800 hover:text-amber-100 rounded border border-stone-800 transition-all active:scale-95">+15m</button>
                    <button onclick="addTime(30)"
                        class="py-3 px-2 text-sm font-bold text-stone-400 bg-stone-950 hover:bg-stone-800 hover:text-amber-100 rounded border border-stone-800 transition-all active:scale-95">+30m</button>
                    <button onclick="addTime(45)"
                        class="py-3 px-2 text-sm font-bold text-stone-400 bg-stone-950 hover:bg-stone-800 hover:text-amber-100 rounded border border-stone-800 transition-all active:scale-95">+45m</button>
                    <button onclick="addTime(60)"
                        class="py-3 px-2 text-sm font-bold text-stone-400 bg-stone-950 hover:bg-stone-800 hover:text-amber-100 rounded border border-stone-800 transition-all active:scale-95">+60m</button>
                </div>

                <!-- Custom Input -->
                <div class="flex gap-2 justify-between items-center bg-stone-950 p-2 rounded border border-stone-800">
                    <input type="number" inputmode="numeric" pattern="[0-9]*" id="timer-input" min="1" max="999"
                        placeholder="Custom"
                        class="w-full bg-transparent text-stone-300 text-lg p-2 focus:outline-none placeholder:text-stone-700">
                    <span class="text-stone-600 text-sm font-bold mr-2">MIN</span>
                    <button onclick="setCustomTimer()"
                        class="px-6 py-2 text-sm font-bold text-stone-950 bg-amber-700 hover:bg-amber-600 rounded transition-colors whitespace-nowrap">
                        Set
                    </button>
                </div>

                <button onclick="clearTime()"
                    class="w-full mt-4 py-2 text-xs font-bold text-red-900/50 hover:text-red-500 hover:bg-red-950/30 rounded transition-colors uppercase tracking-widest">Stop
                    Timer</button>
            </div>

            <!-- Pomodoro Timer -->
            <div
                class="bg-stone-900/50 p-6 rounded-lg border border-stone-800 backdrop-blur-sm shadow-xl flex flex-col justify-between">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3 text-stone-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12" />
                        </svg>
                        <span class="text-base font-bold uppercase tracking-wider">Pomodoro</span>
                    </div>
                    <span id="pomo-status" class="text-stone-500 font-mono text-lg font-bold">Ready</span>
                </div>

                <div class="text-center mb-6">
                    <div id="pomo-display" class="text-4xl font-mono text-amber-500 font-bold mb-2">25:00</div>
                    <div class="flex justify-center gap-2 text-xs text-stone-600 uppercase tracking-widest">
                        <span id="pomo-mode-focus" class="text-red-700 font-bold">Focus</span>
                        <span>/</span>
                        <span id="pomo-mode-break">Break</span>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button id="pomo-start-btn"
                        class="flex-1 py-2 bg-stone-950 border border-stone-800 text-stone-400 hover:text-amber-100 hover:border-amber-900 rounded transition-colors font-bold uppercase tracking-widest text-sm">
                        Start
                    </button>
                    <button id="pomo-reset-btn"
                        class="px-4 py-2 bg-stone-950 border border-stone-800 text-stone-400 hover:text-red-400 hover:border-red-900 rounded transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Presets -->
            <div
                class="bg-stone-900/50 p-6 rounded-lg border border-stone-800 backdrop-blur-sm shadow-xl flex flex-col justify-between">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3 text-stone-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                            <polyline points="14 2 14 8 20 8" />
                        </svg>
                        <span class="text-base font-bold uppercase tracking-wider">Presets</span>
                    </div>
                </div>

                <div class="flex flex-col gap-3 mb-4 max-h-32 overflow-y-auto" id="preset-list">
                    <!-- Presets will be injected here -->
                    <div class="text-stone-600 text-sm italic text-center py-2">No saved presets</div>
                </div>

                <div class="flex gap-2">
                    <input type="text" id="preset-name" placeholder="Mix Name"
                        class="flex-1 bg-stone-950 border border-stone-800 rounded px-3 py-2 text-sm text-stone-300 focus:outline-none focus:border-amber-900">
                    <button id="save-preset-btn"
                        class="px-3 py-2 bg-amber-900/20 border border-amber-900/50 text-amber-500 hover:bg-amber-900/40 rounded transition-colors text-sm font-bold">
                        Save
                    </button>
                </div>
            </div>

        </div>

        <!-- Background Selection Modal -->
        <div id="bg-modal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 hidden opacity-0 transition-opacity duration-300">
            <div class="bg-stone-900 border border-red-900/50 p-6 rounded-lg max-w-lg w-full m-4 shadow-2xl relative">
                <button id="bg-modal-close" class="absolute top-4 right-4 text-stone-500 hover:text-red-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
                <h2 class="text-2xl font-medieval text-red-700 mb-6 text-center">Choose Your Lair</h2>
                <div class="grid grid-cols-2 gap-4 max-h-[60vh] overflow-y-auto pr-2">
                    <button onclick="selectBackground('obsidian')"
                        class="p-4 bg-stone-950 border border-stone-800 hover:border-red-900 rounded flex flex-col items-center gap-2 group">
                        <div class="w-full h-16 bg-stone-900 rounded opacity-50 group-hover:opacity-100 transition-opacity"
                            style="background-color: #0c0a09"></div>
                        <span class="text-stone-400 group-hover:text-amber-100">Obsidian Keep</span>
                    </button>
                    <button onclick="selectBackground('Crimson')"
                        class="p-4 bg-stone-950 border border-stone-800 hover:border-red-900 rounded flex flex-col items-center gap-2 group">
                        <div class="w-full h-16 bg-red-950 rounded opacity-50 group-hover:opacity-100 transition-opacity"
                            style="background-color: #450a0a"></div>
                        <span class="text-stone-400 group-hover:text-amber-100">Crimson Cave</span>
                    </button>
                    <button onclick="selectBackground('Misty')"
                        class="p-4 bg-stone-950 border border-stone-800 hover:border-red-900 rounded flex flex-col items-center gap-2 group">
                        <div class="w-full h-16 bg-slate-900 rounded opacity-50 group-hover:opacity-100 transition-opacity"
                            style="background-color: #0f172a"></div>
                        <span class="text-stone-400 group-hover:text-amber-100">Misty Peaks</span>
                    </button>
                    <button onclick="selectBackground('Golden')"
                        class="p-4 bg-stone-950 border border-stone-800 hover:border-red-900 rounded flex flex-col items-center gap-2 group">
                        <div class="w-full h-16 bg-amber-900 rounded opacity-50 group-hover:opacity-100 transition-opacity"
                            style="background-color: #451a03"></div>
                        <span class="text-stone-400 group-hover:text-amber-100">Gold Hoard</span>
                    </button>
                    <!-- New Backgrounds -->
                    <button onclick="selectBackground('Emerald')"
                        class="p-4 bg-stone-950 border border-stone-800 hover:border-emerald-900 rounded flex flex-col items-center gap-2 group">
                        <div class="w-full h-16 bg-emerald-900 rounded opacity-50 group-hover:opacity-100 transition-opacity"
                            style="background-color: #064e3b"></div>
                        <span class="text-stone-400 group-hover:text-amber-100">Emerald Sanctuary</span>
                    </button>
                    <button onclick="selectBackground('Amethyst')"
                        class="p-4 bg-stone-950 border border-stone-800 hover:border-purple-900 rounded flex flex-col items-center gap-2 group">
                        <div class="w-full h-16 bg-purple-900 rounded opacity-50 group-hover:opacity-100 transition-opacity"
                            style="background-color: #581c87"></div>
                        <span class="text-stone-400 group-hover:text-amber-100">Amethyst Geode</span>
                    </button>
                </div>
            </div>

            <footer class="p-4 text-center text-stone-600 text-sm z-10 border-t border-stone-900 bg-stone-950">
                <p>Forged for the Dragon Keeper</p>
            </footer>

            <!-- Application Logic -->
            <!-- Application Logic -->
            <script src="src/js/script.js"></script>

            <!-- Debug UI -->
            <div id="debug-ui"
                class="fixed bottom-0 right-0 p-4 bg-black/80 text-red-500 font-mono text-xs z-50 pointer-events-none hidden max-w-sm">
                <h3 class="font-bold underline mb-2">Audio Debug Log</h3>
                <div id="debug-log"></div>
            </div>
</body>

</html>